## 秒杀系统设计要点
#### 资源评估

在秒杀开始前需要针对往期数据和经验对秒杀系统可能面临的流量压力和需要的服务计算资源进行整体的评估，以尽可能的保障服务稳定可用。

#### 资源静态化

为了减轻秒杀系统服务端的系统压力，需要提前将商品详情等页面资源静态化提前下发到CND节点中，以减少真正秒杀时候服务器的压力。

#### 流量网关（负载均衡）

单个Tomcat服务器无法承受秒杀时的海量请求，常用的LVS+nginx的方式实现负载均衡。
LVS：四层负载，进行主备部署，提高系统可用性
Nginx：通过Nginx进行负载均衡，将海量的请求相对均衡的转发给真正提供服务的上游服务器。同时我们还可以在这一层做恶意请求过滤拦截，抵御掉大量的无效请求。

#### 系统限流

1. 在秒杀开始前在页面上做限制，不允许用户点击秒杀商品按钮；秒杀开始后不允许用户重复提交相同请求。
2. 秒杀开始后由Sentinel、Hystrix等限流组件对流量进行过滤和拦截处理，防止多大的流量请求到达业务服务压垮系统。

#### 秒杀服务集群部署

通过微服务的架构设计，将秒杀系统作为单独的系统独立的进行分布式部署，在秒杀开始前增加相关的机器和资源。同时由于秒杀系统时独立部署一个服务挂掉也不会造成雪崩影响到用户和订单等系统的稳定。

#### 内存+库存预热

针对面临海量请求的秒杀系统，肯定不能让流量到达数据库；所以我们需要做大量的缓存，通过redis让秒杀业务直接在内存中完成数据的读写。当然一台Redis可能扛不住流量洪峰，我们还需要进行Redis的集群部署，做主从同步、读写分离，通过Redis Sentinel保障高可用。
秒杀开始时那一两秒的时间系统需要承受巨大的请求压力；为不使巨大的流量直接到达数据库，所以需要提前进行系统预热，将库存等数据提前加载到Redis集群中。

#### 服务降级&熔断

在秒杀业务开始时我们可以将一些非必要的物流、评论等非核心业务暂时关闭腾出资源保障秒杀交易业务。
当然由于秒杀面临的请求规模是个未知数，或者由于我们对服务资源预估不足完全有可能在海量的冲击下压垮秒杀系统；为了不致造成系统雪崩还需要设置熔断开关，将流量拦截以免影响其它关键业务系统的稳定。

#### 异步处理

为降低系统的压力需要削峰填谷，可以先将巨大的秒杀请求流量接下来先写入消息队列中，然后在流量洪峰过后在慢慢的进行相关联业务的处理。